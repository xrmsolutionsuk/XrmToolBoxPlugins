using System;
using System.Collections.Generic;
using System.ComponentModel.Composition;
using System.IO;
using System.Linq;
using System.Reflection;
using XrmToolBox.Extensibility;
using XrmToolBox.Extensibility.Interfaces;

namespace XrmSolutionsUK.XrmToolBoxPlugins.ManagedSolutionLayerRaiser
{
    // Do not forget to update version number and author (company attribute) in AssemblyInfo.cs class
    // To generate Base64 string for Images below, you can use https://www.base64-image.de/
    [Export(typeof(IXrmToolBoxPlugin)),
        ExportMetadata("Name", "Managed Solution Layer Raiser"),
        ExportMetadata("Description", "Quickly, easily and safely raise your organization-owned managed solutions to the top of the stack of managed layers to resolve environmental inconsistencies and make your application behave as you intended without losing data"),
        // Please specify the base64 content of a 32x32 pixels image
        ExportMetadata("SmallImageBase64", "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"),
        // Please specify the base64 content of a 80x80 pixels image
        ExportMetadata("BigImageBase64", "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"),
        ExportMetadata("BackgroundColor", "LightCyan"),
        ExportMetadata("PrimaryFontColor", "Black"),
        ExportMetadata("SecondaryFontColor", "Gray")]
    public class Plugin : PluginBase, IPayPalPlugin
    {
        public string DonationDescription => "Thank you for using the Managed Solution Layer Raiser XrmToolBox plugin. If you have found it helpful, please consider making a donation";

        public string EmailAccount => "info@xrmsolutionsuk.com";

        public override IXrmToolBoxPluginControl GetControl()
        {
            return new PluginControl();
        }

        /// <summary>
        /// Constructor 
        /// </summary>
        public Plugin()
        {
            // If you have external assemblies that you need to load, uncomment the following to 
            // hook into the event that will fire when an Assembly fails to resolve
            // AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(AssemblyResolveEventHandler);
        }

        /// <summary>
        /// Event fired by CLR when an assembly reference fails to load
        /// Assumes that related assemblies will be loaded from a subfolder named the same as the Plugin
        /// For example, a folder named Sample.XrmToolBox.MyPlugin 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="args"></param>
        /// <returns></returns>
        private Assembly AssemblyResolveEventHandler(object sender, ResolveEventArgs args)
        {
            Assembly loadAssembly = null;
            Assembly currAssembly = Assembly.GetExecutingAssembly();

            // base name of the assembly that failed to resolve
            var argName = args.Name.Substring(0, args.Name.IndexOf(","));

            // check to see if the failing assembly is one that we reference.
            List<AssemblyName> refAssemblies = currAssembly.GetReferencedAssemblies().ToList();
            var refAssembly = refAssemblies.Where(a => a.Name == argName).FirstOrDefault();

            // if the current unresolved assembly is referenced by our plugin, attempt to load
            if (refAssembly != null)
            {
                // load from the path to this plugin assembly, not host executable
                string dir = Path.GetDirectoryName(currAssembly.Location).ToLower();
                string folder = Path.GetFileNameWithoutExtension(currAssembly.Location);
                dir = Path.Combine(dir, folder);

                var assmbPath = Path.Combine(dir, $"{argName}.dll");

                if (File.Exists(assmbPath))
                {
                    loadAssembly = Assembly.LoadFrom(assmbPath);
                }
                else
                {
                    throw new FileNotFoundException($"Unable to locate dependency: {assmbPath}");
                }
            }

            return loadAssembly;
        }
    }
}